# Debian 12 VPS 一键安全配置脚本

## 快速安装
```bash
bash <(curl -fsSL vps-yy.vercel.app)
```

## 脚本功能

### 🔒 安全加固
- **SSH 安全配置**
  - 自定义 SSH 端口（避免默认 22 端口攻击）
  - 禁用密码登录，仅允许密钥认证
  - 配置 SSH 公钥认证
  - 优化连接保活和超时设置
  - 限制最大认证尝试次数

- **fail2ban 入侵防护**
  - 自动检测和封禁暴力破解 IP
  - SSH 失败 3 次封禁 7 天
  - 支持多种攻击模式检测
  - 自动配置日志监控

- **UFW 防火墙配置**
  - 默认拒绝所有入站连接
  - 仅开放必要端口（SSH、HTTP、HTTPS）
  - 自动配置防火墙规则

### ⚡ 系统优化
- **针对低配置 VPS 优化**
  - 限制系统日志大小（总计 30MB）
  - 配置日志轮转和自动清理
  - 优化内存和磁盘使用
  - 定期清理缓存和临时文件

- **系统维护自动化**
  - 每周自动清理日志和缓存
  - 自动删除过期文件
  - 监控磁盘空间使用

### 🛠️ 系统配置
- **基础环境设置**
  - 更新系统到最新版本
  - 安装必要的安全工具
  - 配置时区为亚洲/上海
  - 启用系统服务自启动

- **日志管理优化**
  - 限制 systemd 日志大小
  - 配置 rsyslog 优化
  - 自动压缩和清理旧日志

## 使用要求

- **系统要求**: Debian 12
- **权限要求**: root 用户权限
- **网络要求**: 能够访问 GitHub 和软件源
- **磁盘空间**: 建议至少 1GB 可用空间

## 安装过程

1. **系统检查**: 验证 Debian 版本和系统资源
2. **用户交互**: 输入自定义 SSH 端口和公钥
3. **安全配置**: 配置 SSH、fail2ban 和防火墙
4. **系统优化**: 配置日志管理和自动清理
5. **服务启动**: 启动并验证所有安全服务

## 配置文件

- `sshd_config`: SSH 服务安全配置
- `jail.local`: fail2ban 入侵检测规则
- `vercel.json`: 脚本分发配置

## 安全特性

- ✅ 禁用 root 密码登录
- ✅ 强制使用 SSH 密钥认证
- ✅ 自动封禁暴力破解 IP
- ✅ 防火墙白名单机制
- ✅ 日志监控和告警
- ✅ 系统资源优化

## 注意事项

⚠️ **重要提醒**:
- 脚本会修改 SSH 端口，请确保记录新端口号
- 执行前请准备好 SSH 公钥
- 建议在执行前备份重要配置文件
- 完成后建议重启系统以确保配置生效

## 故障排除

如果遇到连接问题：
1. 检查新的 SSH 端口是否正确
2. 确认 SSH 公钥格式正确
3. 通过 VPS 控制台恢复访问
4. 检查防火墙规则是否正确